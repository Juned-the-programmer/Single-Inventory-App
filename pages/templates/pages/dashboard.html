{% extends 'pages/base.html' %}
{% load user_auth %}
{% load static %}
{% block title %}
    Dashboard
{% endblock title %}

{% block content %}

<div class="row">
  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-6 col-12">
    <div class="page-header">
      <h2 class="pageheader-title" style="color: black">Profit</h2>
      <hr style="border: 2px solid #7185b4; border-radius: 5px" />
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Previous Month Profit</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{previous_month_profit}}</h1>
          {% else %}
            <h1>{{previous_month_profit}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-1"></div>
    </div>
  </div>
  
  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Current Month Profit</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{current_month_profit}}</h1>
          {% else %}
            <h1>{{current_month_profit}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-12 col-sm-12 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Total Profit</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
        {% if request.user|has_group:"Estimate" %}
            <h1>0</h1>
          {% else %}
            <h1>0</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>
</div>

<div class="row pt-3">
  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-6 col-12">
    <div class="page-header">
      <h2 class="pageheader-title" style="color: black">Sales</h2>
      <hr style="border: 2px solid #7185b4; border-radius: 5px" />
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Previous Month Sales</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
            {% if request.user|has_group:"Estimate" %}
            <h1>{{previous_month_sale}}</h1>
          {% else %}
            <h1>{{previous_month_sale}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-1"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Current Month Sales</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{current_month_sale}}</h1>
          {% else %}
            <h1>{{current_month_sale}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-12 col-sm-12 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Today Sales</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{today_sale}}</h1>
          {% else %}
            <h1>{{today_sale}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>
</div>

<div class="row pt-3">
  <div class="col-xl-12 col-lg-12 col-md-12 col-sm-6 col-12">
    <div class="page-header">
      <h2 class="pageheader-title" style="color: black">Purchase</h2>
      <hr style="border: 2px solid #7185b4; border-radius: 5px" />
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Previous Month Purchase</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{previous_month_total_purchase}}</h1>
          {% else %}
            <h1>{{previous_month_total_purchase}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-1"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Current Month Purchase</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{current_month_purchase}}</h1>
          {% else %}
            <h1>{{current_month_purchase}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-12 col-sm-12 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Today Purchase</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{today_purchase}}</h1>
          {% else %}
            <h1>{{today_purchase}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-xl-12 pt-3 col-lg-12 col-md-12 col-sm-12 col-12">
    <div class="page-header">
      <h2 class="pageheader-title" style="color: black">Product</h2>
      <strong
        ><hr style="border: 2px solid #7185b4; border-radius: 5px"
      /></strong>
    </div>
  </div>
</div>

<div class="row">
   <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Total Product</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{productdata}}</h1>
          {% else %}
            <h1>{{productdata}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-1"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">In Stock</h3>
        <div class="metric-value d-inline-block">
          {% if request.user|has_group:"Estimate" %}
            <h1 class="instock mb-1">0</h1>
          {% else %}
            <h1 class="instock mb-1">0</h1>
          {% endif %}
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>

  <div class="col-xl-4 col-lg-4 pt-3 col-md-12 col-sm-12 col-12">
    <a href="">
      <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
        <div class="card-body stockclass">
          <h3 class="stocktext">Out of Stock</h3>
          <div class="metric-value d-inline-block">
            {% if request.user|has_group:"Estimate" %}
            <h1 class="outstock">0</h1>
          {% else %}
            <h1 class="outstock">0</h1>
          {% endif %}
          </div>
        </div>
        <div id="sparkline-2"></div>
      </div>
    </a>
  </div>
</div>


<div class="row">
  <div class="col-xl-12 pt-3 col-lg-12 col-md-12 col-sm-12 col-12">
    <div class="page-header">
      <h2 class="pageheader-title" style="color: black">
        Total Customers And Suppliers
      </h2>
      <strong
        ><hr style="border: 2px solid #7185b4; border-radius: 5px"
      /></strong>
    </div>
  </div>
</div>
<div class="row">
  <div class="col-xl-6 col-lg-6 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Total Customer</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{customerdata}}</h1>
          {% else %}
            <h1>{{customerdata}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-1"></div>
    </div>
  </div>

  <div class="col-xl-6 col-lg-6 pt-3 col-md-6 col-sm-6 col-12">
    <div class="card h-100" style="filter: drop-shadow(3px 3px 4px gray)">
      <div class="card-body">
        <h3 class="text-muted">Total Supplier</h3>
        <div class="metric-value d-inline-block">
          <h1 class="mb-1 text-primary">
          {% if request.user|has_group:"Estimate" %}
            <h1>{{supplierdata}}</h1>
          {% else %}
            <h1>{{supplierdata}}</h1>
          {% endif %}
          </h1>
        </div>
      </div>
      <div id="sparkline-2"></div>
    </div>
  </div>
</div>

<script src="{% static 'vendor/jquery/jquery-3.3.1.min.js' %}"></script>

<script>
  $(document).ready(function () {
    var minimum_stock =[]
    var stock = []
    $.ajax({
      type:"GET",
      url: "{% url 'product_data_estimate' %}",
      async : false,
      success: function(response){
        minimum_stock = response
      },
    })

    $.ajax({
      type:"GET",
      url: "{% url 'stock_data_estimate' %}",
      async : false,
      success: function(response){ 
        stock = response
      },
    })
    var counter_stock = 0;
    var stock_total_value = 0;
    for(var i=0;i<minimum_stock.productdata.length;i++){
      if(minimum_stock.productdata[i].minimum_stock >= stock.stock_data[i].quantity){
        counter_stock+=1;
        console.log(counter_stock)
      }
      stock_total_value += stock.stock_data[i].quantity * stock.stock_data[i].purchase_price
    }
    if (counter_stock >= 1){
      $('.card_out').css('background-color','red');
      $('.stocktext').css('color','black')
      $('.outstock').css('color','black')
    }
    else{
      $('.stocktext').addClass("text-muted")
      $('.outstock').addClass("mb-1 text-primary")
    }
    $('.outstock').text(counter_stock)
    $('.stock_value').text(stock_total_value)
    $('.instock').text(minimum_stock.productdata.length - counter_stock)
  })
</script>
  
{% endblock content %}